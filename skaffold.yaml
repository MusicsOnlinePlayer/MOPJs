apiVersion: skaffold/v2beta11
kind: Config
metadata:
  name: mopjs
build:
  artifacts:
  - image: malauryd/mop_deezerimporter
    context: Services
    sync:
      infer:
        - '/Services/DeezerImporter/Service/**/*'
        - '/Services/lib/**/*'
    docker:
      dockerfile: DeezerImporter/Dockerfile
  - image: malauryd/mop_deezerindexer
    context: Services
    sync:
      infer:
        - '/Services/DeezerIndexer/Service/**/*'
        - '/Services/lib/**/*'
    docker:
      dockerfile: DeezerIndexer/Dockerfile
  - image: malauryd/mop_musicmanager
    context: Services
    sync:
      infer:
        - '/Services/MusicManager/Service/**/*'
        - '/Services/lib/**/*'
    docker:
      dockerfile: MusicManager/Dockerfile
  - image: malauryd/mop_usermanager
    context: Services
    sync:
      infer:
        - '/Services/UserManager/Service/**/*'
        - '/Services/lib/**/*'
    docker:
      dockerfile: UserManager/Dockerfile
  - image: malauryd/mop_musicsearch
    context: Services
    sync:
      infer:
        - '/Services/MusicSearch/Service/**/*'
        - '/Services/lib/**/*'
    docker:
      dockerfile: MusicSearch/Dockerfile
  - image: malauryd/mop_deezerdownloader
    context: Services
    sync:
      infer:
        - '/Services/DeezerDownloader/Service/**/*'
        - '/Kubernetes/secrets.yaml'
        - '/Services/lib/**/*'
    docker:
      dockerfile: DeezerDownloader/Dockerfile
  - image: malauryd/mop_static
    context: Public
    sync:
      infer:
        - '/Public/**/*'
    docker:
      dockerfile: Dockerfile
  - image: malauryd/mop_musicfrontend
    context: Services
    sync:
      infer:
        - '/Services/MusicFrontend/Frontend/**/*'
        - '/Services/lib/**/*'
    docker:
      dockerfile: MusicFrontend/Dockerfile
  - image: malauryd/mop_authentication
    context: Services
    sync:
      infer:
        - '/Services/Authentication/Frontend/**/*'
        - '/Services/lib/**/*'
    docker:
      dockerfile: Authentication/Dockerfile
deploy:
  kubectl:
    manifests:
    - Kubernetes/mongo.yaml
    - Kubernetes/minio.yaml
    - Kubernetes/secrets.yaml
    # - Kubernetes/monitoring.yaml
    - Services/DeezerImporter/deployment.yaml
    - Services/DeezerIndexer/deployment.yaml
    - Services/UserManager/deployment.yaml
    - Services/MusicSearch/deployment.yaml
    - Services/MusicManager/deployment.yaml
    - Services/DeezerDownloader/deployment.yaml
    - Kubernetes/nginx.yaml
    - Services/MusicFrontend/deployment.yaml
    - Services/Authentication/deployment.yaml
    - Kubernetes/ingress.yaml
