apiVersion: skaffold/v2beta11
kind: Config
metadata:
  name: mopjs
build:
  artifacts:
  - image: malauryd/mop_deezerimporter
    context: Services
    sync:
      infer:
        - '/Services/DeezerImporter/Service/**/*'
        - '/Services/lib/**/*'
    docker:
      dockerfile: DeezerImporter/Dockerfile
  - image: malauryd/mop_deezerindexer
    context: Services
    sync:
      infer:
        - '/Services/DeezerIndexer/Service/**/*'
        - '/Services/lib/**/*'
    docker:
      dockerfile: DeezerIndexer/Dockerfile
  - image: malauryd/mop_musicmanager
    context: Services
    sync:
      infer:
        - '/Services/MusicManager/Service/**/*'
        - '/Services/lib/**/*'
    docker:
      dockerfile: MusicManager/Dockerfile
  - image: malauryd/mop_musicsearch
    context: Services
    sync:
      infer:
        - '/Services/MusicSearch/Service/**/*'
        - '/Services/lib/**/*'
    docker:
      dockerfile: MusicSearch/Dockerfile
  - image: malauryd/mop_static
    context: Public
    sync:
      infer:
        - '/Public/**/*'
    docker:
      dockerfile: Dockerfile
  - image: malauryd/mop_musicfrontend
    context: Services
    sync:
      infer:
        - '/Services/MusicFrontend/Frontend/**/*'
        - '/Services/lib/**/*'
    docker:
      dockerfile: MusicFrontend/Dockerfile
deploy:
  kubectl:
    manifests:
    - Kubernetes/mongo.yaml
    # - Kubernetes/monitoring.yaml
    - Services/DeezerImporter/deployment.yaml
    - Services/DeezerIndexer/deployment.yaml
    - Services/MusicSearch/deployment.yaml
    - Services/MusicManager/deployment.yaml
    - Kubernetes/nginx.yaml
    - Services/MusicFrontend/deployment.yaml
    - Kubernetes/ingress.yaml
